<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Parking Violations Dashboard</title>
<style>
    body {
        font-family: 'Segoe UI', sans-serif;
        background: #eef2f3;
        margin: 0; padding: 0;
    }
    header {
        background: #0077ff;
        color: white;
        text-align: center;
        padding: 20px;
        font-size: 28px;
        font-weight: bold;
    }
    .container {
        width: 850px; margin: 25px auto;
        background: white; padding: 20px;
        border-radius: 10px;
        box-shadow: 0px 4px 12px rgba(0,0,0,0.15);
    }
    .message {
        text-align: center;
        font-weight: bold;
        margin: 10px 0;
        color: #d62b00;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 12px;
    }
    th, td {
        padding: 10px; text-align: center;
        border-bottom: 1px solid #bbb;
    }
    th {
        background: #0077ff;
        color: white;
    }
</style>
</head>

<body>
<header>Parking Violations Dashboard</header>

<div class="container">

<h2>Add New Violation</h2>
<div class="message" id="addMsg"></div>
<input type="text" id="addPlate" placeholder="Vehicle number">
<button onclick="addViolation()">Submit</button>

<h2>Search Violations</h2>
<div class="message" id="searchMsg"></div>
<input type="text" id="searchPlate" placeholder="Vehicle number">
<button onclick="searchViolations()">Search</button>

<h2>Make Payment</h2>
<div class="message" id="payMsg"></div>
<input type="text" id="payPlate" placeholder="Vehicle number">
<input type="number" id="payAmount" placeholder="Amount">
<button onclick="makePayment()">Pay</button>

<div id="results"></div>

</div>

<script>
async function addViolation() {
    let plate = document.getElementById("addPlate").value.trim();
    let msg = document.getElementById("addMsg");
    if (!plate) return;
    let res = await fetch("http://127.0.0.1:8000/api/new_violation", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({number: plate})
    });
    let data = await res.json();
    msg.textContent = data.message;
}

async function searchViolations() {
    const plate = document.getElementById("searchPlate").value.trim();
    const msg = document.getElementById("searchMsg");
    const results = document.getElementById("results");
    if (!plate) return;

    const res = await fetch(`http://127.0.0.1:8000/api/get_vehicle/${plate}`);
    const data = await res.json();

    if (data.status === "no_record") {
        msg.textContent = "No violation exists. Clean record üéâ";
        results.innerHTML = "";
        return;
    }

    if (data.status === "no_dues") {
        msg.textContent = "No dues. All clear ‚úîÔ∏è";
        results.innerHTML = "";
        return;
    }

    msg.textContent = "";
    let rec = data.record;

    let html = `<table><tr><th>Type</th><th>Timestamp</th><th>Amount</th></tr>`;
    let total = rec.fine;

    rec.breakdown.forEach(x=>{
        html += `<tr><td>${x.type}</td><td>${x.timestamp}</td><td>${x.amount}</td></tr>`;
    });

    html += `<tr><th>Total Due</th><th></th><th>${total}</th></tr>`;
    html += `</table>`;
    results.innerHTML = html;
}

async function makePayment() {
    const plate = document.getElementById("payPlate").value.trim();
    const amt = document.getElementById("payAmount").value;
    const msg = document.getElementById("payMsg");

    if (!plate || !amt) return;

    const res = await fetch("http://127.0.0.1:8000/api/pay_fine", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({number: plate, amount: parseInt(amt)})
    });

    const data = await res.json();
    msg.textContent = data.message;
    searchViolations();
}
</script>

</body>
</html>
